# Архітектура інформаційної системи управління бізнес-діяльністю підприємства

## Огляд

Інформаційна система управління бізнес-діяльністю підприємства побудована на мікросервісній архітектурі, що забезпечує гнучкість, масштабованість та стійкість до відмов. Система складається з набору незалежних сервісів, кожен з яких відповідає за окрему функціональну область та може розгортатися, масштабуватися та оновлюватися незалежно від інших сервісів.

## Ключові принципи архітектури

1. **Мікросервісна архітектура** - система розділена на невеликі, незалежні сервіси, кожен з яких виконує конкретну бізнес-функцію.
2. **API-first підхід** - всі сервіси взаємодіють через чітко визначені API, що забезпечує гнучкість інтеграції.
3. **Контейнеризація** - всі сервіси упаковані в Docker-контейнери для забезпечення однакового середовища розробки, тестування та експлуатації.
4. **Оркестрація контейнерів** - використання Kubernetes для управління контейнерами, забезпечення високої доступності та масштабування.
5. **Розподілена база даних** - кожен сервіс має власну базу даних, що забезпечує незалежність та ізоляцію даних.
6. **Асинхронна комунікація** - використання повідомлень для асинхронної взаємодії між сервісами.
7. **Централізоване логування та моніторинг** - збір логів та метрик з усіх сервісів для забезпечення спостережуваності системи.
8. **Безпека за замовчуванням** - всі комунікації захищені TLS, впроваджено RBAC та шифрування чутливих даних.

## Компоненти системи

### 1. Фронтенд

Фронтенд системи побудований як Single Page Application (SPA) з використанням React. Він забезпечує інтерфейс користувача для взаємодії з системою та комунікує з бекендом через API Gateway.

**Технології:**
- React
- Material-UI
- React Query
- Formik + Yup
- React Router
- bpmn-js (для візуалізації BPMN-моделей)

### 2. API Gateway

API Gateway служить єдиною точкою входу для всіх клієнтських запитів до бекенду. Він відповідає за маршрутизацію запитів до відповідних мікросервісів, автентифікацію, авторизацію та обмеження швидкості.

**Технології:**
- Node.js
- Express
- JWT для автентифікації
- Redis для кешування та обмеження швидкості

### 3. Мікросервіси

Система складається з наступних мікросервісів:

#### 3.1. Auth Service

Відповідає за автентифікацію, авторизацію, управління користувачами, ролями та дозволами.

**Технології:**
- Node.js
- Express
- PostgreSQL
- JWT
- Bcrypt

#### 3.2. Order Service

Управляє замовленнями, їх статусами, елементами та процесом обробки замовлень.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування

#### 3.3. Customer Service

Управляє клієнтами, їх контактною інформацією, історією замовлень та програмами лояльності.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування

#### 3.4. Product Service

Управляє товарами, категоріями, цінами та характеристиками товарів.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування
- Elasticsearch для пошуку

#### 3.5. Inventory Service

Управляє товарними запасами, складами, переміщеннями товарів та інвентаризацією.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування

#### 3.6. Finance Service

Управляє фінансовими операціями, платежами, рахунками та фінансовою звітністю.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування

#### 3.7. Analytics Service

Збирає та аналізує дані з інших сервісів для формування аналітичних звітів та дашбордів.

**Технології:**
- Python
- FastAPI
- PostgreSQL
- Redis для кешування
- Pandas для аналізу даних

#### 3.8. Integration Service

Забезпечує інтеграцію з зовнішніми сервісами, такими як Nova Poshta, Rozetka та банківські API.

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування
- Bull для управління чергами завдань

#### 3.9. Notification Service

Відповідає за відправку повідомлень користувачам через різні канали (email, SMS, push-повідомлення).

**Технології:**
- Node.js
- Express
- PostgreSQL
- Redis для кешування
- Bull для управління чергами завдань

### 4. Бази даних

Кожен мікросервіс має власну базу даних для забезпечення незалежності та ізоляції даних. Основною СУБД є PostgreSQL, яка забезпечує надійність, продуктивність та підтримку JSON для гнучкості схеми даних.

**Технології:**
- PostgreSQL
- Redis для кешування та сесій
- Elasticsearch для повнотекстового пошуку

### 5. Повідомлення та події

Для асинхронної комунікації між сервісами використовується система обміну повідомленнями, що забезпечує слабкий зв'язок між сервісами та підвищує стійкість системи.

**Технології:**
- RabbitMQ або Kafka
- Bull для управління чергами завдань

### 6. Інфраструктура

Система розгортається в контейнерах Docker, оркеструється Kubernetes та може бути розгорнута як в хмарі, так і на власній інфраструктурі.

**Технології:**
- Docker
- Kubernetes
- Helm для управління розгортанням
- Prometheus для моніторингу
- Grafana для візуалізації метрик
- ELK Stack (Elasticsearch, Logstash, Kibana) для централізованого логування

## Діаграми архітектури

### Загальна архітектура системи

```
+----------------+     +----------------+     +----------------+
|                |     |                |     |                |
|   Web Client   |     |  Mobile App    |     |  External API  |
|                |     |                |     |                |
+-------+--------+     +-------+--------+     +-------+--------+
        |                      |                      |
        v                      v                      v
+-------+--------------------------------------------+--------+
|                                                             |
|                         API Gateway                         |
|                                                             |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+------+
      |     |     |     |     |     |     |     |     |
      v     v     v     v     v     v     v     v     v
+-----+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+
|        | |     | |     | |     | |     | |     | |     |
|  Auth  | |Order| |Cust.| |Prod.| |Inv. | |Fin. | |Anal.|
|Service | |Serv.| |Serv.| |Serv.| |Serv.| |Serv.| |Serv.|
|        | |     | |     | |     | |     | |     | |     |
+-----+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+
      |     |     |     |     |     |     |     |     |
      v     v     v     v     v     v     v     v     v
+-----+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+ +--+--+
|        | |     | |     | |     | |     | |     | |     |
|  Auth  | |Order| |Cust.| |Prod.| |Inv. | |Fin. | |Anal.|
|   DB   | | DB  | | DB  | | DB  | | DB  | | DB  | | DB  |
|        | |     | |     | |     | |     | |     | |     |
+--------+ +-----+ +-----+ +-----+ +-----+ +-----+ +-----+
```

### Архітектура мікросервісу

```
+----------------+     +----------------+
|                |     |                |
|   API Gateway  |     |  Other Service |
|                |     |                |
+-------+--------+     +-------+--------+
        |                      |
        v                      v
+-------+----------------------+--------+
|                                       |
|              API Layer                |
|                                       |
+-------+----------------------+--------+
        |                      |
        v                      v
+-------+--------+     +-------+--------+
|                |     |                |
| Business Logic |     |  Event Handler |
|                |     |                |
+-------+--------+     +-------+--------+
        |                      |
        v                      v
+-------+--------+     +-------+--------+
|                |     |                |
|  Data Access   |     |  Message Queue |
|                |     |                |
+-------+--------+     +----------------+
        |
        v
+-------+--------+
|                |
|   Database     |
|                |
+----------------+
```

## Потоки даних

### Процес обробки замовлення

1. Клієнт створює замовлення через фронтенд.
2. Запит надходить до API Gateway, який автентифікує користувача та перенаправляє запит до Order Service.
3. Order Service створює замовлення та зберігає його в базі даних.
4. Order Service відправляє події про створення замовлення через систему обміну повідомленнями.
5. Inventory Service отримує подію та резервує товари для замовлення.
6. Finance Service отримує подію та створює рахунок для оплати.
7. Integration Service отримує подію та ініціює процес оплати через зовнішній платіжний шлюз.
8. Після успішної оплати Finance Service відправляє подію про оплату замовлення.
9. Order Service отримує подію та оновлює статус замовлення.
10. Notification Service отримує подію та відправляє повідомлення клієнту про підтвердження замовлення.
11. Integration Service отримує подію та створює експрес-накладну через API Nova Poshta.
12. Order Service отримує інформацію про відправлення та оновлює статус замовлення.
13. Notification Service відправляє повідомлення клієнту з інформацією про відправлення.

## Безпека

### Автентифікація та авторизація

- Всі запити до API автентифікуються за допомогою JWT.
- Авторизація базується на ролях та дозволах (RBAC).
- Токени мають обмежений термін дії та можуть бути відкликані.
- Паролі зберігаються в хешованому вигляді з використанням bcrypt.

### Захист даних

- Всі комунікації захищені TLS.
- Чутливі дані шифруються за допомогою AES.
- Впроваджено механізми захисту від SQL-ін'єкцій, XSS та CSRF.
- Регулярно проводиться аудит безпеки та тестування на проникнення.

### Моніторинг безпеки

- Логування всіх дій користувачів та системних подій.
- Моніторинг підозрілої активності та спроб несанкціонованого доступу.
- Автоматичне блокування IP-адрес при виявленні підозрілої активності.

## Масштабування

### Горизонтальне масштабування

- Кожен мікросервіс може бути масштабований горизонтально шляхом додавання нових екземплярів.
- Kubernetes автоматично масштабує сервіси на основі навантаження.
- Бази даних можуть бути масштабовані за допомогою реплікації та шардингу.

### Вертикальне масштабування

- Окремі сервіси можуть бути масштабовані вертикально шляхом збільшення ресурсів (CPU, пам'ять).
- Бази даних можуть бути масштабовані вертикально для обробки більшого обсягу даних.

## Відмовостійкість

### Висока доступність

- Всі компоненти системи розгортаються в кількох екземплярах для забезпечення високої доступності.
- Kubernetes забезпечує автоматичне відновлення після збоїв.
- Бази даних налаштовані на реплікацію для забезпечення резервного копіювання та швидкого відновлення.

### Обробка помилок

- Впроваджено механізми повторних спроб з експоненціальною затримкою для обробки тимчасових помилок.
- Використовується шаблон Circuit Breaker для запобігання каскадним відмовам.
- Всі помилки логуються та відстежуються для швидкого виявлення та усунення проблем.

## Моніторинг та логування

### Моніторинг

- Prometheus збирає метрики з усіх сервісів.
- Grafana візуалізує метрики та надає дашборди для моніторингу системи.
- Налаштовані сповіщення для оповіщення про проблеми в системі.

### Логування

- Всі сервіси відправляють логи до централізованої системи логування (ELK Stack).
- Логи структуровані та містять контекстну інформацію для полегшення аналізу.
- Kibana надає інтерфейс для пошуку та аналізу логів.

## Розгортання

### Середовища

- Розробка (Development) - середовище для розробки та тестування нових функцій.
- Тестування (Staging) - середовище для інтеграційного тестування та перевірки перед випуском.
- Виробництво (Production) - середовище для кінцевих користувачів.

### CI/CD

- Автоматизований процес збірки, тестування та розгортання.
- Використання GitLab CI/CD або GitHub Actions для автоматизації процесу.
- Автоматичне розгортання в середовище тестування після успішного проходження тестів.
- Розгортання у виробниче середовище після схвалення.

## Подальший розвиток

### Короткострокові плани

- Впровадження GraphQL для оптимізації запитів з фронтенду.
- Покращення системи моніторингу та сповіщень.
- Розширення інтеграцій з зовнішніми сервісами.

### Довгострокові плани

- Впровадження машинного навчання для прогнозування попиту та оптимізації запасів.
- Розробка мобільного додатку для клієнтів та співробітників.
- Міграція на serverless архітектуру для окремих компонентів системи.

## Висновки

Архітектура інформаційної системи управління бізнес-діяльністю підприємства побудована на сучасних принципах розробки програмного забезпечення та забезпечує гнучкість, масштабованість, безпеку та стійкість до відмов. Мікросервісна архітектура дозволяє незалежно розробляти, тестувати та розгортати окремі компоненти системи, що прискорює процес розробки та спрощує підтримку системи.

## Додаткові матеріали

- [Детальна документація API](../api/README.md)
- [Опис бізнес-процесів (BPMN)](../../bpmn-models/README.md)
- [Схема бази даних](../database-er-diagram.puml)
- [Посібники користувача](../user-guides/README.md)
